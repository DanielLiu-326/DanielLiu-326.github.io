<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Gnome启用Wayland | Daniel的博客</title><meta name="author" content="Daniel Liu"><meta name="copyright" content="Daniel Liu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文介绍了如何解决gnome桌面环境没有默认采用Wayland的问题。">
<meta property="og:type" content="article">
<meta property="og:title" content="Gnome启用Wayland">
<meta property="og:url" content="https://danielliu-326.github.io/2023/09/01/gnome_wayland/index.html">
<meta property="og:site_name" content="Daniel的博客">
<meta property="og:description" content="本文介绍了如何解决gnome桌面环境没有默认采用Wayland的问题。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://danielliu-326.github.io/images/top_images/gnome_wayland.webp">
<meta property="article:published_time" content="2023-08-31T19:41:03.000Z">
<meta property="article:modified_time" content="2025-09-02T16:30:24.793Z">
<meta property="article:author" content="Daniel Liu">
<meta property="article:tag" content="Daniel">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://danielliu-326.github.io/images/top_images/gnome_wayland.webp"><link rel="shortcut icon" href="/images/icon.png"><link rel="canonical" href="https://danielliu-326.github.io/2023/09/01/gnome_wayland/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Daniel Liu","link":"链接: ","source":"来源: Daniel的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Gnome启用Wayland',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-03 00:30:24'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://q.qlogo.cn/g?b=qq&amp;nk=2370161748&amp;s=640" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('/images/top_images/gnome_wayland.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="Daniel的博客"><img class="site-icon" src="/images/icon.png"/><span class="site-name">Daniel的博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Gnome启用Wayland</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-31T19:41:03.000Z" title="发表于 2023-09-01 03:41:03">2023-09-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-02T16:30:24.793Z" title="更新于 2025-09-03 00:30:24">2025-09-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Gnome启用Wayland"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h2><p>使用gdm登录管理器，且没有wayland和xorg选项，登录后显示是x11.</p>
<h2 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h2><p>与这个问题相关的应该有两个配置文件</p>
<ul>
<li>&#x2F;etc&#x2F;gdm&#x2F;custom.conf</li>
<li>&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;rules.d&#x2F;61-gdm.rules</li>
</ul>
<p>这两个配置文件是关于gdm登录选项的。<br>第一个文件大概长这样：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GDM configuration storage</span></span><br><span class="line"></span><br><span class="line"><span class="section">[daemon]</span></span><br><span class="line"><span class="comment"># Uncomment the line below to force the login screen to use Xorg</span></span><br><span class="line"><span class="comment"># WaylandEnable=false</span></span><br><span class="line"></span><br><span class="line"><span class="section">[security]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[xdmcp]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[chooser]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[debug]</span></span><br><span class="line"><span class="comment"># Uncomment the line below to turn on debugging</span></span><br><span class="line"><span class="comment">#Enable=true</span></span><br></pre></td></tr></table></figure>
<p>其中WaylandEnable&#x3D;false表示关闭wayland，如果这句话前面有”#“，即被注释掉，就表示启用，请确保它是被注释的状态。</p>
<p>另一个文件长这样：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">disable</span> Wayland on Hi1710 chipsets</span></span><br><span class="line">ATTR&#123;vendor&#125;==&quot;0x19e5&quot;, ATTR&#123;device&#125;==&quot;0x1711&quot;, GOTO=&quot;gdm_disable_wayland&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">disable</span> Wayland <span class="keyword">if</span> modesetting is disabled</span></span><br><span class="line">KERNEL!=&quot;card[0-9]*&quot;, GOTO=&quot;gdm_nomodeset_end&quot;</span><br><span class="line">SUBSYSTEM!=&quot;drm&quot;, GOTO=&quot;gdm_nomodeset_end&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">but keep it enabled <span class="keyword">for</span> simple framebuffer drivers</span></span><br><span class="line">DRIVERS==&quot;simple-framebuffer&quot;, GOTO=&quot;gdm_nomodeset_end&quot;</span><br><span class="line">IMPORT&#123;cmdline&#125;=&quot;nomodeset&quot;, GOTO=&quot;gdm_disable_wayland&quot;</span><br><span class="line">LABEL=&quot;gdm_nomodeset_end&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Disable wayland when nvidia modeset is disabled or when drivers are a lower</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">version than 470, <span class="keyword">in</span> any <span class="keyword">case</span> always prefer Xorg</span></span><br><span class="line">KERNEL!=&quot;nvidia_drm&quot;, GOTO=&quot;gdm_nvidia_drm_end&quot;</span><br><span class="line">SUBSYSTEM!=&quot;module&quot;, GOTO=&quot;gdm_nvidia_drm_end&quot;</span><br><span class="line">ACTION!=&quot;add&quot;, GOTO=&quot;gdm_nvidia_drm_end&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">disable</span> wayland <span class="keyword">if</span> nvidia-drm modeset is not enabled</span></span><br><span class="line">ATTR&#123;parameters/modeset&#125;!=&quot;Y&quot;, GOTO=&quot;gdm_disable_wayland&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">disable</span> wayland <span class="keyword">for</span> nvidia drivers versions lower than 470</span></span><br><span class="line">ATTR&#123;version&#125;==&quot;4[0-6][0-9].*|[0-3][0-9][0-9].*|[0-9][0-9].*|[0-9].*&quot;, GOTO=&quot;gdm_disable_wayland&quot;</span><br><span class="line">GOTO=&quot;gdm_prefer_xorg&quot;</span><br><span class="line">LABEL=&quot;gdm_nvidia_drm_end&quot;</span><br><span class="line"></span><br><span class="line">GOTO=&quot;gdm_end&quot;</span><br><span class="line"></span><br><span class="line">LABEL=&quot;gdm_prefer_xorg&quot;</span><br><span class="line">RUN+=&quot;/usr/lib/gdm-runtime-config set daemon PreferredDisplayServer xorg&quot;</span><br><span class="line">GOTO=&quot;gdm_end&quot;</span><br><span class="line"></span><br><span class="line">LABEL=&quot;gdm_disable_wayland&quot;</span><br><span class="line">RUN+=&quot;/usr/lib/gdm-runtime-config set daemon WaylandEnable false&quot;</span><br><span class="line">GOTO=&quot;gdm_end&quot;</span><br><span class="line"></span><br><span class="line">LABEL=&quot;gdm_end&quot;</span><br></pre></td></tr></table></figure>
<p>这个文件由label和goto组成，GOTO语句的语法就是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;条件&gt;,GOTO=&quot;&lt;LABEL名&gt;&quot;</span><br></pre></td></tr></table></figure>
<p>表示如果满足条件，则跳转到相应的label。<br>上面代码中，标签：</p>
<ul>
<li>gdm_disable_wayland：表示禁用wayland</li>
<li>gdm_prefer_xorg：表示优先选择xorg。</li>
</ul>
<p>这里我们再加入一项label到&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;rules.d&#x2F;61-gdm.rules中，名叫gdm_prefer_wayland，表示优先采用wayland：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LABEL=&quot;gdm_prefer_wayland&quot;</span><br><span class="line">RUN+=&quot;/usr/lib/gdm-runtime-config set daemon PreferredDisplayServer wayland&quot;</span><br><span class="line">GOTO=&quot;gdm_end&quot;</span><br></pre></td></tr></table></figure>
<p>并在文件开头直接goto到这个标签<br><code>GOTO = &quot;gdm_prefer_wayland&quot;</code><br>现在整个文件应该长这样：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">added manually. directly prefer wayland.</span></span><br><span class="line">GOTO=&quot;gdm_prefer_wayland&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">disable</span> Wayland on Hi1710 chipsets</span></span><br><span class="line">ATTR&#123;vendor&#125;==&quot;0x19e5&quot;, ATTR&#123;device&#125;==&quot;0x1711&quot;, GOTO=&quot;gdm_disable_wayland&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">disable</span> Wayland <span class="keyword">if</span> modesetting is disabled</span></span><br><span class="line">KERNEL!=&quot;card[0-9]*&quot;, GOTO=&quot;gdm_nomodeset_end&quot;</span><br><span class="line">SUBSYSTEM!=&quot;drm&quot;, GOTO=&quot;gdm_nomodeset_end&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">but keep it enabled <span class="keyword">for</span> simple framebuffer drivers</span></span><br><span class="line">DRIVERS==&quot;simple-framebuffer&quot;, GOTO=&quot;gdm_nomodeset_end&quot;</span><br><span class="line">IMPORT&#123;cmdline&#125;=&quot;nomodeset&quot;, GOTO=&quot;gdm_disable_wayland&quot;</span><br><span class="line">LABEL=&quot;gdm_nomodeset_end&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Disable wayland when nvidia modeset is disabled or when drivers are a lower</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">version than 470, <span class="keyword">in</span> any <span class="keyword">case</span> always prefer Xorg</span></span><br><span class="line">KERNEL!=&quot;nvidia_drm&quot;, GOTO=&quot;gdm_nvidia_drm_end&quot;</span><br><span class="line">SUBSYSTEM!=&quot;module&quot;, GOTO=&quot;gdm_nvidia_drm_end&quot;</span><br><span class="line">ACTION!=&quot;add&quot;, GOTO=&quot;gdm_nvidia_drm_end&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">disable</span> wayland <span class="keyword">if</span> nvidia-drm modeset is not enabled</span></span><br><span class="line">ATTR&#123;parameters/modeset&#125;!=&quot;Y&quot;, GOTO=&quot;gdm_disable_wayland&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">disable</span> wayland <span class="keyword">for</span> nvidia drivers versions lower than 470</span></span><br><span class="line">ATTR&#123;version&#125;==&quot;4[0-6][0-9].*|[0-3][0-9][0-9].*|[0-9][0-9].*|[0-9].*&quot;, GOTO=&quot;gdm_disable_wayland&quot;</span><br><span class="line">GOTO=&quot;gdm_prefer_xorg&quot;</span><br><span class="line">LABEL=&quot;gdm_nvidia_drm_end&quot;</span><br><span class="line"></span><br><span class="line">GOTO=&quot;gdm_end&quot;</span><br><span class="line"></span><br><span class="line">LABEL=&quot;gdm_prefer_xorg&quot;</span><br><span class="line">RUN+=&quot;/usr/lib/gdm-runtime-config set daemon PreferredDisplayServer xorg&quot;</span><br><span class="line">GOTO=&quot;gdm_end&quot;</span><br><span class="line"></span><br><span class="line">LABEL=&quot;gdm_disable_wayland&quot;</span><br><span class="line">RUN+=&quot;/usr/lib/gdm-runtime-config set daemon WaylandEnable false&quot;</span><br><span class="line">GOTO=&quot;gdm_end&quot;</span><br><span class="line"></span><br><span class="line">LABEL=&quot;gdm_prefer_wayland&quot;</span><br><span class="line">RUN+=&quot;/usr/lib/gdm-runtime-config set daemon PreferredDisplayServer wayland&quot;</span><br><span class="line">GOTO=&quot;gdm_end&quot;</span><br><span class="line"></span><br><span class="line">LABEL=&quot;gdm_end&quot;</span><br></pre></td></tr></table></figure>
<p>如果设置到这里，你已经能在第一次启动的时候进入wayland，并且登出后登陆也可以的话那就已经完成设置了，不需要继续往下看了，如果登出后在登陆就不是wayland了，或者，第一次登陆不是wayland，请接着看下面的设置。</p>
<p>参照帖子<a target="_blank" rel="noopener" href="https://bbs.archlinux.org/viewtopic.php?id=270441">Wayland doesn’t appear as an option on first login per boot</a>中seth的说法：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/NVIDIA#Early_loading">https://wiki.archlinux.org/title/NVIDIA#Early_loading</a><br><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/NVIDIA#DRM_kernel_mode_setting">https://wiki.archlinux.org/title/Kernel … _KMS_start</a></p>
</blockquote>
<p>以及Fingel：</p>
<blockquote>
<p>I have this same problem, but adding the Nvidia modules to &#x2F;etc&#x2F;mkinitcpio.conf has made Wayland completely disappear as an option to log in to Gnome with, whereas before if I logged into X11 and then logged out, I could choose Wayland as an option.<br>&#x2F;etc&#x2F;mkinitcpio.conf:<br>MODULES&#x3D;(btrfs nvidia nvidia_modeset nvidia_uvm nvidia_drm)<br>BINARIES&#x3D;(&#x2F;usr&#x2F;bin&#x2F;btrfs)<br>FILES&#x3D;()<br>HOOKS&#x3D;(base udev autodetect keyboard keymap modconf block encrypt filesystems fsck)<br>I did run mkinitcpio -P after modifying the config.<br>Something I’m missing here?</p>
</blockquote>
<p>最终在：<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Kernel_mode_setting#Early_KMS_start">https://wiki.archlinux.org/title/Kernel_mode_setting#Early_KMS_start</a><br>找到：</p>
<blockquote>
<p>KMS is typically initialized after the initramfs stage. However, it is possible to enable KMS already during the initramfs stage. Add the required module for the video driver to the initramfs configuration file:   </p>
<ul>
<li>amdgpu for AMDGPU, or radeon when using the legacy ATI driver.</li>
<li>i915 for Intel graphics.</li>
<li>nouveau for the open-source Nouveau driver.</li>
<li>mgag200 for Matrox graphics.</li>
<li>Depending on QEMU graphics in use: virtio-gpu for VirtIO, qxl for QXL, or cirrus for Cirrus.</li>
<li>nvidia nvidia_modeset nvidia_uvm nvidia_drm for nvidia driver. See NVIDIA#DRM kernel mode setting for details.</li>
</ul>
</blockquote>
<p>翻译一下就是：<br>KMS一般会在initramfs阶段后启动。但是，也可以让kms在initramfs阶段前就绪，加入所需要的显卡驱动的module到initramfs配置文件中：</p>
<ul>
<li>amdgpu：对应 AMD的gpu, 或使用 radeon 对应传统的ATI驱动</li>
<li>i915：对应英特尔图形</li>
<li>nouveau：对应开元Nouveau驱动</li>
<li>mgag200：对应Matrox驱动</li>
<li>QEMU图形：virtio-gpu for VirtIO, qxl for QXL, or cirrus for Cirrus.</li>
<li>nvidia nvidia_modeset nvidia_uvm nvidia_drm：对应英伟达显卡（更多细节查看<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/NVIDIA#DRM_kernel_mode_setting">DRM_kernel_mode_setting</a>）.</li>
</ul>
<p>简而言之就是可能在gdm加载的时候显卡驱动相关的一些东西还没有启动，所以应当让相关的module在initramfs阶段前就绪。</p>
<p>我的设备用的是amd显卡和英伟达显卡，所以这里应该</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/mkinitcpio.conf</span><br></pre></td></tr></table></figure>
<p>在MODULES中加入相关内容，这是加入后的文件示例，不要复制粘贴，直接加入与你设备相关的内容即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MODULES=&quot;btrfs nvidia nvidia_modeset nvidia_uvm nvidia_drm nouveau amdgpu&quot;</span><br><span class="line"></span><br><span class="line">BINARIES=(/usr/bin/btrfs)</span><br><span class="line"></span><br><span class="line">FILES=&quot;&quot;</span><br><span class="line"></span><br><span class="line">HOOKS=&quot;base udev autodetect modconf block keyboard keymap filesystems fsck&quot;</span><br></pre></td></tr></table></figure>
<p>BINARIES&#x3D;(&#x2F;usr&#x2F;bin&#x2F;btrfs)</p>
<p>使配置生效：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkinitcpio -P</span><br></pre></td></tr></table></figure>
<p>如果此过程中出错，说明文件内容有错误，应该重新修改文件内容。<br>非英伟达显卡配置到这里就结束了，英伟达显卡还需要在内核参数中添加<code>nvidia-drm.modeset=1</code><br>打开&#x2F;etc&#x2F;default&#x2F;grub文件进行编辑：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/default/grub</span><br></pre></td></tr></table></figure>
<p>找到GRUB_CMDLINE_LINUX_DEFAULT配置项，添加nvidia-drm.modeset&#x3D;1，如果原来有其他内容则需要在最后加个空格，添加<code>nvidia-drm.modeset=1</code>，如果一开始是空，则直接添加即可，这是我配置后的结果，不要复制粘贴：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet udev.log_priority=3 nvidia-drm.modeset=1&quot;</span><br></pre></td></tr></table></figure>
<p>使配置生效：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>


<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://bbs.archlinux.org/viewtopic.php?id=270441">https://bbs.archlinux.org/viewtopic.php?id=270441</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Kernel_mode_setting#Early_KMS_start">https://wiki.archlinux.org/title/Kernel_mode_setting#Early_KMS_start</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/NVIDIA#DRM_kernel_mode_setting">https://wiki.archlinux.org/title/NVIDIA#DRM_kernel_mode_setting</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Kernel_parameters">https://wiki.archlinux.org/title/Kernel_parameters</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/NVIDIA#DRM_kernel_mode_setting">https://wiki.archlinux.org/title/NVIDIA#DRM_kernel_mode_setting</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://danielliu-326.github.io">Daniel Liu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://danielliu-326.github.io/2023/09/01/gnome_wayland/">https://danielliu-326.github.io/2023/09/01/gnome_wayland/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://danielliu-326.github.io" target="_blank">Daniel的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/images/top_images/gnome_wayland.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechat_reward_qrcode.png" target="_blank"><img class="post-qr-code-img" src="/images/wechat_reward_qrcode.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/29/gnome_optimization/" title="让 Gnome 更加易用和流畅"><img class="cover" src="/images/top_images/index.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">让 Gnome 更加易用和流畅</div></div></a></div><div class="next-post pull-right"><a href="/2023/09/01/new_begining/" title="第一篇博客：新的开始"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">第一篇博客：新的开始</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://q.qlogo.cn/g?b=qq&amp;nk=2370161748&amp;s=640" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Daniel Liu</div><div class="author-info__description">太卧槽了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/DanielLiu-326"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/DanielLiu-326" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:lhlh326@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">坚决谴责日本倾倒核废水事件！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">问题：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">解决方法：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">3.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/05/11/docker_openwrt/" title="双网口工控机 docker openwrt 作为主路由"><img src="/images/top_images/index.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="双网口工控机 docker openwrt 作为主路由"/></a><div class="content"><a class="title" href="/2025/05/11/docker_openwrt/" title="双网口工控机 docker openwrt 作为主路由">双网口工控机 docker openwrt 作为主路由</a><time datetime="2025-05-11T15:43:37.000Z" title="发表于 2025-05-11 23:43:37">2025-05-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/29/gnome_optimization/" title="让 Gnome 更加易用和流畅"><img src="/images/top_images/index.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="让 Gnome 更加易用和流畅"/></a><div class="content"><a class="title" href="/2023/10/29/gnome_optimization/" title="让 Gnome 更加易用和流畅">让 Gnome 更加易用和流畅</a><time datetime="2023-10-29T03:37:37.000Z" title="发表于 2023-10-29 11:37:37">2023-10-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/01/gnome_wayland/" title="Gnome启用Wayland"><img src="/images/top_images/gnome_wayland.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Gnome启用Wayland"/></a><div class="content"><a class="title" href="/2023/09/01/gnome_wayland/" title="Gnome启用Wayland">Gnome启用Wayland</a><time datetime="2023-08-31T19:41:03.000Z" title="发表于 2023-09-01 03:41:03">2023-09-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/09/01/new_begining/" title="第一篇博客：新的开始">第一篇博客：新的开始</a><time datetime="2023-08-31T19:41:03.000Z" title="发表于 2023-09-01 03:41:03">2023-09-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Daniel Liu</div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const initGitalk = () => {
    const gitalk = new Gitalk(Object.assign({
      clientID: '55c7f9032b811b8b7c66',
      clientSecret: '027e76ef955725ba40d99d7aa2dd408a29b249fb',
      repo: 'DanielLiu-326.github.io',
      owner: 'DanielLiu-326',
      admin: ['DanielLiu-326'],
      id: '3e52c3ab4741c076d43196a811ee5f59',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async() => {
    if (typeof Gitalk === 'function') initGitalk()
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk()
    }
  }
  
  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  if ('Gitalk' === 'Gitalk' || !true) {
    if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>